{"remainingRequest":"F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\babel-loader\\lib\\index.js!F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\vue-document-editor\\src\\DocumentEditor\\DocumentEditor.vue?vue&type=script&lang=js","dependencies":[{"path":"F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\vue-document-editor\\src\\DocumentEditor\\DocumentEditor.vue","mtime":499162500000},{"path":"F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\babel.config.js","mtime":1624271518206},{"path":"F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkY6L1NWTiBQUk9KRUNUUy9FUlBfSG9zcGl0YWxfQ2xpZW50L3RydW5rL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5IjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRjovU1ZOIFBST0pFQ1RTL0VSUF9Ib3NwaXRhbF9DbGllbnQvdHJ1bmsvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIgZnJvbSAiRjovU1ZOIFBST0pFQ1RTL0VSUF9Ib3NwaXRhbF9DbGllbnQvdHJ1bmsvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZW50cmllcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0IHsgZGVmaW5lQ3VzdG9tRWxlbWVudCB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IG1vdmVfY2hpbGRyZW5fZm9yd2FyZF9yZWN1cnNpdmVseSwgbW92ZV9jaGlsZHJlbl9iYWNrd2FyZHNfd2l0aF9tZXJnaW5nIH0gZnJvbSAnLi9pbXBvcnRzL3BhZ2UtdHJhbnNpdGlvbi1tZ210LmpzJzsKZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICAvLyBUaGlzIGNvbnRhaW5zIHRoZSBpbml0aWFsIGNvbnRlbnQgb2YgdGhlIGRvY3VtZW50IHRoYXQgY2FuIGJlIHN5bmNlZAogICAgLy8gSXQgbXVzdCBiZSBhbiBBcnJheTogZWFjaCBhcnJheSBpdGVtIGlzIGEgbmV3IHNldCBvZiBwYWdlcyBjb250YWluaW5nIHRoZQogICAgLy8gaXRlbSAoc3RyaW5nIG9yIGNvbXBvbmVudCkuIFlvdSBjYW4gc2VlIHRoYXQgYXMgcHJlZGVmaW5lZCBwYWdlIGJyZWFrcy4KICAgIC8vIFNlZSB0aGUgRGVtby52dWUgZmlsZSBmb3IgYSBnb29kIHVzYWdlIGV4YW1wbGUuCiAgICBjb250ZW50OiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIC8vIERpc3BsYXkgbW9kZSBvZiB0aGUgcGFnZXMKICAgIGRpc3BsYXk6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiZ3JpZCIgLy8gWyJncmlkIiwgImhvcml6b250YWwiLCAidmVydGljYWwiXQoKICAgIH0sCiAgICAvLyBTZXRzIHdoZXRoZXIgZG9jdW1lbnQgdGV4dCBjYW4gYmUgbW9kaWZpZWQKICAgIGVkaXRhYmxlOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCiAgICAvLyBPdmVybGF5IGZ1bmN0aW9uIHJldHVybmluZyBwYWdlIGhlYWRlcnMgYW5kIGZvb3RlcnMgaW4gSFRNTAogICAgb3ZlcmxheTogRnVuY3Rpb24sCiAgICAvLyBQYWdlcyBmb3JtYXQgaW4gbW0gKHNob3VsZCBiZSBhbiBhcnJheSBjb250YWluaW5nIFt3aWR0aCwgaGVpZ2h0XSkKICAgIHBhZ2VfZm9ybWF0X21tOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gWzIxMCwgMjk3XTsKICAgICAgfQogICAgfSwKICAgIC8vIFBhZ2UgbWFyZ2lucyBpbiBDU1MKICAgIHBhZ2VfbWFyZ2luczogewogICAgICB0eXBlOiBbU3RyaW5nLCBGdW5jdGlvbl0sCiAgICAgIGRlZmF1bHQ6ICIxMG1tIDE1bW0iCiAgICB9LAogICAgLy8gRGlzcGxheSB6b29tLiBPbmx5IGFjdHMgb24gdGhlIHNjcmVlbiBkaXNwbGF5CiAgICB6b29tOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogMS4wCiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcGFnZXM6IFtdLAogICAgICAvLyBjb250YWlucyB7dXVpZCwgY29udGVudF9pZHgsIHByZXZfaHRtbCwgdGVtcGxhdGUsIHByb3BzLCBlbHR9IGZvciBlYWNoIHBhZ2VzIG9mIHRoZSBkb2N1bWVudAogICAgICBwYWdlc19vdmVybGF5X3JlZnM6IHt9LAogICAgICAvLyBjb250YWlucyBwYWdlIG92ZXJsYXkgcmVmIGVsZW1lbnRzIGluZGV4ZWQgYnkgdXVpZAogICAgICBwYWdlc19oZWlnaHQ6IDAsCiAgICAgIC8vIHJlYWwgbWVhc3VyZWQgcGFnZSBoZWlnaHQgaW4gcHggKGNvcnJlc3BvbmRpbmcgdG8gcGFnZV9mb3JtYXRfbW1bMV0pCiAgICAgIGVkaXRvcl93aWR0aDogMCwKICAgICAgLy8gcmVhbCBtZWFzdXJlZCB3aXRoIG9mIGFuIGVtcHR5IGVkaXRvciA8ZGl2PiBpbiBweAogICAgICBwcmV2ZW50X25leHRfY29udGVudF91cGRhdGVfZnJvbV9wYXJlbnQ6IGZhbHNlLAogICAgICAvLyB3b3JrYXJvdW5kIHRvIGF2b2lkIGluZmluaXRlIHVwZGF0ZSBsb29wCiAgICAgIGN1cnJlbnRfdGV4dF9zdHlsZTogZmFsc2UsCiAgICAgIC8vIGNvbnRhaW5zIHRoZSBzdHlsZSBhdCBjYXJldCBwb3NpdGlvbgogICAgICBwcmludGluZ19tb2RlOiBmYWxzZSAvLyBmbGFnIHNldCB3aGVuIHBhZ2UgaXMgcmVuZGVyaW5nIGluIHByaW50aW5nIG1vZGUKCiAgICB9OwogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHRoaXMudXBkYXRlX2VkaXRvcl93aWR0aCgpOwogICAgdGhpcy51cGRhdGVfY3NzX21lZGlhX3N0eWxlKCk7CiAgICB0aGlzLnJlc2V0X2NvbnRlbnQoKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCB0aGlzLnVwZGF0ZV9lZGl0b3Jfd2lkdGgpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy5wcm9jZXNzX2N1cnJlbnRfdGV4dF9zdHlsZSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JlcHJpbnQiLCB0aGlzLmJlZm9yZV9wcmludCk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYWZ0ZXJwcmludCIsIHRoaXMuYWZ0ZXJfcHJpbnQpOwogIH0sCiAgYmVmb3JlVXBkYXRlOiBmdW5jdGlvbiBiZWZvcmVVcGRhdGUoKSB7CiAgICB0aGlzLnBhZ2VzX292ZXJsYXlfcmVmcyA9IFtdOwogIH0sCiAgYmVmb3JlVW5tb3VudDogZnVuY3Rpb24gYmVmb3JlVW5tb3VudCgpIHsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJyZXNpemUiLCB0aGlzLnVwZGF0ZV9lZGl0b3Jfd2lkdGgpOwogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy5wcm9jZXNzX2N1cnJlbnRfdGV4dF9zdHlsZSk7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYmVmb3JlcHJpbnQiLCB0aGlzLmJlZm9yZV9wcmludCk7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJwcmludCIsIHRoaXMuYWZ0ZXJfcHJpbnQpOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGNzc19tZWRpYV9zdHlsZTogZnVuY3Rpb24gY3NzX21lZGlhX3N0eWxlKCkgewogICAgICAvLyBjcmVhdGVzIGEgQ1NTIDxzdHlsZT4gYW5kIHJldHVybnMgaXQKICAgICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7CiAgICAgIHJldHVybiBzdHlsZTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIENvbXB1dGVzIGEgcmFuZG9tIDUtY2hhciBVVUlECiAgICBuZXdfdXVpZDogZnVuY3Rpb24gbmV3X3V1aWQoKSB7CiAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgtNSk7CiAgICB9LAogICAgLy8gUmVzZXRzIGFsbCBjb250ZW50IGZyb20gdGhlIGNvbnRlbnQgcHJvcGVydHkKICAgIHJlc2V0X2NvbnRlbnQ6IGZ1bmN0aW9uIHJlc2V0X2NvbnRlbnQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvLyBQcmV2ZW50IGxhdW5jaGluZyB0aGlzIGZ1bmN0aW9uIG11bHRpcGxlIHRpbWVzCiAgICAgIGlmICh0aGlzLnJlc2V0X2luX3Byb2dyZXNzKSByZXR1cm47CiAgICAgIHRoaXMucmVzZXRfaW5fcHJvZ3Jlc3MgPSB0cnVlOyAvLyBJZiBwcm92aWRlZCBjb250ZW50IGlzIGVtcHR5LCBpbml0aWFsaXplIGl0IGZpcnN0IGFuZCBleGl0CgogICAgICBpZiAoIXRoaXMuY29udGVudC5sZW5ndGgpIHsKICAgICAgICB0aGlzLnJlc2V0X2luX3Byb2dyZXNzID0gZmFsc2U7CiAgICAgICAgdGhpcy4kZW1pdCgidXBkYXRlOmNvbnRlbnQiLCBbIiJdKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gRGVsZXRlIGFsbCBwYWdlcyBhbmQgc2V0IG9uZSBuZXcgcGFnZSBwZXIgY29udGVudCBpdGVtCgoKICAgICAgdGhpcy5wYWdlcyA9IHRoaXMuY29udGVudC5tYXAoZnVuY3Rpb24gKGNvbnRlbnQsIGNvbnRlbnRfaWR4KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHV1aWQ6IF90aGlzLm5ld191dWlkKCksCiAgICAgICAgICBjb250ZW50X2lkeDogY29udGVudF9pZHgsCiAgICAgICAgICB0ZW1wbGF0ZTogY29udGVudC50ZW1wbGF0ZSwKICAgICAgICAgIHByb3BzOiBjb250ZW50LnByb3BzCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHRoaXMudXBkYXRlX3BhZ2VzX2VsdHMoKTsgLy8gR2V0IHBhZ2UgaGVpZ2h0IGZyb20gZmlyc3QgZW1wdHkgcGFnZQoKICAgICAgdmFyIGZpcnN0X3BhZ2VfZWx0ID0gdGhpcy5wYWdlc1swXS5lbHQ7CiAgICAgIGlmICghdGhpcy4kcmVmcy5jb250ZW50LmNvbnRhaW5zKGZpcnN0X3BhZ2VfZWx0KSkgdGhpcy4kcmVmcy5jb250ZW50LmFwcGVuZENoaWxkKGZpcnN0X3BhZ2VfZWx0KTsgLy8gcmVzdG9yZSBwYWdlIGluIERPTSBpbiBjYXNlIGl0IHdhcyByZW1vdmVkCgogICAgICB0aGlzLnBhZ2VzX2hlaWdodCA9IGZpcnN0X3BhZ2VfZWx0LmNsaWVudEhlaWdodCArIDE7IC8vIGFsbG93IG9uZSBwaXhlbCBwcmVjaXNpb24KICAgICAgLy8gSW5pdGlhbGl6ZSB0ZXh0IHBhZ2VzCgogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5wYWdlcyksCiAgICAgICAgICBfc3RlcDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBwYWdlID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAvLyBzZXQgcmF3IEhUTUwgY29udGVudAogICAgICAgICAgaWYgKCF0aGlzLmNvbnRlbnRbcGFnZS5jb250ZW50X2lkeF0pIHBhZ2UuZWx0LmlubmVySFRNTCA9ICI8ZGl2Pjxicj48L2Rpdj4iO2Vsc2UgaWYgKHR5cGVvZiB0aGlzLmNvbnRlbnRbcGFnZS5jb250ZW50X2lkeF0gPT0gInN0cmluZyIpIHBhZ2UuZWx0LmlubmVySFRNTCA9ICI8ZGl2PiIgKyB0aGlzLmNvbnRlbnRbcGFnZS5jb250ZW50X2lkeF0gKyAiPC9kaXY+IjtlbHNlIGlmIChwYWdlLnRlbXBsYXRlKSB7CiAgICAgICAgICAgIHZhciBjb21wb25lbnRFbGVtZW50ID0gZGVmaW5lQ3VzdG9tRWxlbWVudChwYWdlLnRlbXBsYXRlKTsKICAgICAgICAgICAgY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdjb21wb25lbnQtJyArIHBhZ2UudXVpZCwgY29tcG9uZW50RWxlbWVudCk7CiAgICAgICAgICAgIHBhZ2UuZWx0LmFwcGVuZENoaWxkKG5ldyBjb21wb25lbnRFbGVtZW50KHsKICAgICAgICAgICAgICBtb2RlbFZhbHVlOiBwYWdlLnByb3BzCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0gLy8gcmVzdG9yZSBwYWdlIGluIERPTSBpbiBjYXNlIGl0IHdhcyByZW1vdmVkCgogICAgICAgICAgaWYgKCF0aGlzLiRyZWZzLmNvbnRlbnQuY29udGFpbnMocGFnZS5lbHQpKSB0aGlzLiRyZWZzLmNvbnRlbnQuYXBwZW5kQ2hpbGQocGFnZS5lbHQpOwogICAgICAgIH0gLy8gU3ByZWFkIGNvbnRlbnQgb3ZlciBzZXZlcmFsIHBhZ2VzIGlmIGl0IG92ZXJmbG93cwoKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICB9CgogICAgICB0aGlzLmZpdF9jb250ZW50X292ZXJfcGFnZXMoKTsgLy8gUmVtb3ZlIHRoZSB0ZXh0IGN1cnNvciBmcm9tIHRoZSBjb250ZW50LCBpZiBhbnkgKGl0cyBwb3NpdGlvbiBpcyBsb3N0IGFueXdheSkKCiAgICAgIHRoaXMuJHJlZnMuY29udGVudC5ibHVyKCk7IC8vIENsZWFyICJyZXNldCBpbiBwcm9ncmVzcyIgZmxhZwoKICAgICAgdGhpcy5yZXNldF9pbl9wcm9ncmVzcyA9IGZhbHNlOwogICAgfSwKICAgIC8vIFNwcmVhZHMgdGhlIEhUTUwgY29udGVudCBvdmVyIHNldmVyYWwgcGFnZXMgdW50aWwgaXQgZml0cwogICAgZml0X2NvbnRlbnRfb3Zlcl9wYWdlczogZnVuY3Rpb24gZml0X2NvbnRlbnRfb3Zlcl9wYWdlcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAvLyBEYXRhIHZhcmlhYmxlIHRoaXMucGFnZXNfaGVpZ2h0IG11c3QgaGF2ZSBiZWVuIHNldCBiZWZvcmUgY2FsbGluZyB0aGlzIGZ1bmN0aW9uCiAgICAgIGlmICghdGhpcy5wYWdlc19oZWlnaHQpIHJldHVybjsgLy8gUHJldmVudCBsYXVuY2hpbmcgdGhpcyBmdW5jdGlvbiBtdWx0aXBsZSB0aW1lcwoKICAgICAgaWYgKHRoaXMuZml0X2luX3Byb2dyZXNzKSByZXR1cm47CiAgICAgIHRoaXMuZml0X2luX3Byb2dyZXNzID0gdHJ1ZTsgLy8gQ2hlY2sgcGFnZXMgdGhhdCB3ZXJlIGRlbGV0ZWQgZnJvbSB0aGUgRE9NIChzdGFydCBmcm9tIHRoZSBlbmQpCgogICAgICBmb3IgKHZhciBwYWdlX2lkeCA9IHRoaXMucGFnZXMubGVuZ3RoIC0gMTsgcGFnZV9pZHggPj0gMDsgcGFnZV9pZHgtLSkgewogICAgICAgIHZhciBwYWdlID0gdGhpcy5wYWdlc1twYWdlX2lkeF07IC8vIGlmIHVzZXIgZGVsZXRlZCB0aGUgcGFnZSBmcm9tIHRoZSBET00sIHRoZW4gcmVtb3ZlIGl0IGZyb20gdGhpcy5wYWdlcyBhcnJheQoKICAgICAgICBpZiAoIXBhZ2UuZWx0IHx8ICFkb2N1bWVudC5ib2R5LmNvbnRhaW5zKHBhZ2UuZWx0KSkgdGhpcy5wYWdlcy5zcGxpY2UocGFnZV9pZHgsIDEpOwogICAgICB9IC8vIElmIGFsbCB0aGUgZG9jdW1lbnQgd2FzIHdpcGVkIG91dCwgc3RhcnQgYSBuZXcgZW1wdHkgZG9jdW1lbnQKCgogICAgICBpZiAoIXRoaXMucGFnZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy4kZW1pdCgidXBkYXRlOmNvbnRlbnQiLCBbIiJdKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gU2F2ZSBjdXJyZW50IHNlbGVjdGlvbiAob3IgY3Vyc29yIHBvc2l0aW9uKSBieSBpbnNlcnRpbmcgZW1wdHkgSFRNTCBlbGVtZW50cyBhdCB0aGUgc3RhcnQgYW5kIHRoZSBlbmQgb2YgaXQKCgogICAgICB2YXIgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpOwogICAgICB2YXIgc3RhcnRfbWFya2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibnVsbCIpOwogICAgICB2YXIgZW5kX21hcmtlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm51bGwiKTsgLy8gZG9uJ3QgaW5zZXJ0IG1hcmtlcnMgaW4gY2FzZSBzZWxlY3Rpb24gZmFpbHMgKGlmIHdlIGFyZSBlZGl0aW5nIGluIGNvbXBvbmVudHMgaW4gdGhlIHNoYWRvdy1yb290IGl0IHNlbGVjdHMgdGhlIHBhZ2UgPGRpdj4gYXMgYW5jaG9yTm9kZSkKCiAgICAgIGlmIChzZWxlY3Rpb24gJiYgc2VsZWN0aW9uLnJhbmdlQ291bnQgJiYgc2VsZWN0aW9uLmFuY2hvck5vZGUgJiYgIShzZWxlY3Rpb24uYW5jaG9yTm9kZS5kYXRhc2V0ICYmIHNlbGVjdGlvbi5hbmNob3JOb2RlLmRhdGFzZXQuaXNWREVQYWdlICE9IG51bGwpKSB7CiAgICAgICAgdmFyIHJhbmdlID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7CiAgICAgICAgcmFuZ2UuaW5zZXJ0Tm9kZShzdGFydF9tYXJrZXIpOwogICAgICAgIHJhbmdlLmNvbGxhcHNlKGZhbHNlKTsKICAgICAgICByYW5nZS5pbnNlcnROb2RlKGVuZF9tYXJrZXIpOwogICAgICB9IC8vIEJyb3dzZSBldmVyeSByZW1haW5pbmcgcGFnZQoKCiAgICAgIHZhciBwcmV2X3BhZ2VfbW9kaWZpZWRfZmxhZyA9IGZhbHNlOwoKICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoX3BhZ2VfaWR4KSB7CiAgICAgICAgLy8gcGFnZSBsZW5ndGggY2FuIGdyb3cgaW5zaWRlIHRoaXMgbG9vcAogICAgICAgIHZhciBwYWdlID0gX3RoaXMyLnBhZ2VzW19wYWdlX2lkeF07CiAgICAgICAgdmFyIG5leHRfcGFnZSA9IF90aGlzMi5wYWdlc1tfcGFnZV9pZHggKyAxXTsKICAgICAgICB2YXIgbmV4dF9wYWdlX2VsdCA9IG5leHRfcGFnZSA/IG5leHRfcGFnZS5lbHQgOiBudWxsOyAvLyBjaGVjayBpZiB0aGlzIHBhZ2UsIHRoZSBuZXh0IHBhZ2UsIG9yIGFueSBwcmV2aW91cyBwYWdlIGNvbnRlbnQgaGFzIGJlZW4gbW9kaWZpZWQgYnkgdGhlIHVzZXIgKGRvbid0IGFwcGx5IHRvIHRlbXBsYXRlIHBhZ2VzKQoKICAgICAgICBpZiAoIXBhZ2UudGVtcGxhdGUgJiYgKHByZXZfcGFnZV9tb2RpZmllZF9mbGFnIHx8IHBhZ2UuZWx0LmlubmVySFRNTCAhPSBwYWdlLnByZXZfaW5uZXJIVE1MIHx8IG5leHRfcGFnZV9lbHQgJiYgIW5leHRfcGFnZS50ZW1wbGF0ZSAmJiBuZXh0X3BhZ2VfZWx0LmlubmVySFRNTCAhPSBuZXh0X3BhZ2UucHJldl9pbm5lckhUTUwpKSB7CiAgICAgICAgICBwcmV2X3BhZ2VfbW9kaWZpZWRfZmxhZyA9IHRydWU7IC8vIEJBQ0tXQVJELVBST1BBR0FUSU9OCiAgICAgICAgICAvLyBjaGVjayBpZiBjb250ZW50IGRvZXNuJ3Qgb3ZlcmZsb3csIGFuZCB0aGF0IG5leHQgcGFnZSBleGlzdHMgYW5kIGhhcyB0aGUgc2FtZSBjb250ZW50X2lkeAoKICAgICAgICAgIGlmIChwYWdlLmVsdC5jbGllbnRIZWlnaHQgPD0gX3RoaXMyLnBhZ2VzX2hlaWdodCAmJiBuZXh0X3BhZ2UgJiYgbmV4dF9wYWdlLmNvbnRlbnRfaWR4ID09IHBhZ2UuY29udGVudF9pZHgpIHsKICAgICAgICAgICAgLy8gdHJ5IHRvIGFwcGVuZCBldmVyeSBub2RlIGZyb20gdGhlIG5leHQgcGFnZSB1bnRpbCBpdCBkb2Vzbid0IGZpdAogICAgICAgICAgICBtb3ZlX2NoaWxkcmVuX2JhY2t3YXJkc193aXRoX21lcmdpbmcocGFnZS5lbHQsIG5leHRfcGFnZV9lbHQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gIW5leHRfcGFnZV9lbHQuY2hpbGROb2Rlcy5sZW5ndGggfHwgcGFnZS5lbHQuY2xpZW50SGVpZ2h0ID4gX3RoaXMyLnBhZ2VzX2hlaWdodDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IC8vIEZPUldBUkQtUFJPUEFHQVRJT04KICAgICAgICAgIC8vIGNoZWNrIGlmIGNvbnRlbnQgb3ZlcmZsb3dzCgoKICAgICAgICAgIGlmIChwYWdlLmVsdC5jbGllbnRIZWlnaHQgPiBfdGhpczIucGFnZXNfaGVpZ2h0KSB7CiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIG5leHQgcGFnZSBmb3IgdGhlIHNhbWUgY29udGVudCwgY3JlYXRlIGl0CiAgICAgICAgICAgIGlmICghbmV4dF9wYWdlIHx8IG5leHRfcGFnZS5jb250ZW50X2lkeCAhPSBwYWdlLmNvbnRlbnRfaWR4KSB7CiAgICAgICAgICAgICAgbmV4dF9wYWdlID0gewogICAgICAgICAgICAgICAgdXVpZDogX3RoaXMyLm5ld191dWlkKCksCiAgICAgICAgICAgICAgICBjb250ZW50X2lkeDogcGFnZS5jb250ZW50X2lkeAogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIF90aGlzMi5wYWdlcy5zcGxpY2UoX3BhZ2VfaWR4ICsgMSwgMCwgbmV4dF9wYWdlKTsKCiAgICAgICAgICAgICAgX3RoaXMyLnVwZGF0ZV9wYWdlc19lbHRzKCk7CgogICAgICAgICAgICAgIG5leHRfcGFnZV9lbHQgPSBuZXh0X3BhZ2UuZWx0OwogICAgICAgICAgICB9IC8vIG1vdmUgdGhlIGNvbnRlbnQgc3RlcCBieSBzdGVwIHRvIHRoZSBuZXh0IHBhZ2UsIHVudGlsIGl0IGZpdHMKCgogICAgICAgICAgICBtb3ZlX2NoaWxkcmVuX2ZvcndhcmRfcmVjdXJzaXZlbHkocGFnZS5lbHQsIG5leHRfcGFnZV9lbHQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gcGFnZS5lbHQuY2xpZW50SGVpZ2h0IDw9IF90aGlzMi5wYWdlc19oZWlnaHQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSAvLyBDTEVBTklORwogICAgICAgICAgLy8gcmVtb3ZlIG5leHQgcGFnZSBpZiBpdCBpcyBlbXB0eQoKCiAgICAgICAgICBpZiAobmV4dF9wYWdlX2VsdCAmJiBuZXh0X3BhZ2UuY29udGVudF9pZHggPT0gcGFnZS5jb250ZW50X2lkeCAmJiAhbmV4dF9wYWdlX2VsdC5jaGlsZE5vZGVzLmxlbmd0aCkgewogICAgICAgICAgICBfdGhpczIucGFnZXMuc3BsaWNlKF9wYWdlX2lkeCArIDEsIDEpOwogICAgICAgICAgfQogICAgICAgIH0gLy8gdXBkYXRlIHBhZ2VzIGluIHRoZSBET00KCgogICAgICAgIF90aGlzMi51cGRhdGVfcGFnZXNfZWx0cygpOwogICAgICB9OwoKICAgICAgZm9yICh2YXIgX3BhZ2VfaWR4ID0gMDsgX3BhZ2VfaWR4IDwgdGhpcy5wYWdlcy5sZW5ndGg7IF9wYWdlX2lkeCsrKSB7CiAgICAgICAgX2xvb3AoX3BhZ2VfaWR4KTsKICAgICAgfSAvLyBSZXN0b3JlIHNlbGVjdGlvbiBhbmQgcmVtb3ZlIGVtcHR5IGVsZW1lbnRzCgoKICAgICAgaWYgKGRvY3VtZW50LmJvZHkuY29udGFpbnMoc3RhcnRfbWFya2VyKSkgewogICAgICAgIHZhciBfcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpOwoKICAgICAgICBfcmFuZ2Uuc2V0U3RhcnQoc3RhcnRfbWFya2VyLCAwKTsKCiAgICAgICAgaWYgKGRvY3VtZW50LmJvZHkuY29udGFpbnMoZW5kX21hcmtlcikpIF9yYW5nZS5zZXRFbmQoZW5kX21hcmtlciwgMCk7CiAgICAgICAgc2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpOwogICAgICAgIHNlbGVjdGlvbi5hZGRSYW5nZShfcmFuZ2UpOwogICAgICB9CgogICAgICBpZiAoc3RhcnRfbWFya2VyLnBhcmVudEVsZW1lbnQpIHN0YXJ0X21hcmtlci5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHN0YXJ0X21hcmtlcik7CiAgICAgIGlmIChlbmRfbWFya2VyLnBhcmVudEVsZW1lbnQpIGVuZF9tYXJrZXIucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChlbmRfbWFya2VyKTsgLy8gTm9ybWFsaXplIGFuZCBzdG9yZSBjdXJyZW50IHBhZ2UgSFRNTCBjb250ZW50CgogICAgICB2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMucGFnZXMpLAogICAgICAgICAgX3N0ZXAyOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9wYWdlID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgaWYgKCFfcGFnZS50ZW1wbGF0ZSkgX3BhZ2UuZWx0Lm5vcm1hbGl6ZSgpOyAvLyBub3JtYWxpemUgSFRNTCAobWVyZ2UgdGV4dCBub2RlcykgLSBkb24ndCB0b3VjaCB0ZW1wbGF0ZSBwYWdlcyBvciBpdCBjYW4gYnJlYWsgVnVlCgogICAgICAgICAgX3BhZ2UucHJldl9pbm5lckhUTUwgPSBfcGFnZS5lbHQuaW5uZXJIVE1MOyAvLyBzdG9yZSBjdXJyZW50IHBhZ2VzIGlubmVySFRNTCBmb3IgbmV4dCBjYWxsCiAgICAgICAgfSAvLyBDbGVhciAiZml0IGluIHByb2dyZXNzIiBmbGFnCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IyLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IyLmYoKTsKICAgICAgfQoKICAgICAgdGhpcy5maXRfaW5fcHJvZ3Jlc3MgPSBmYWxzZTsKICAgIH0sCiAgICAvLyBJbnB1dCBldmVudAogICAgaW5wdXQ6IGZ1bmN0aW9uIGlucHV0KGUpIHsKICAgICAgaWYgKCFlKSByZXR1cm47IC8vIGNoZWNrIHRoYXQgZXZlbnQgaXMgc2V0CgogICAgICB0aGlzLmZpdF9jb250ZW50X292ZXJfcGFnZXMoKTsgLy8gZml0IGNvbnRlbnQgYWNjb3JkaW5nIHRvIG1vZGlmaWNhdGlvbnMKCiAgICAgIHRoaXMuZW1pdF9uZXdfY29udGVudCgpOyAvLyBlbWl0IGNvbnRlbnQgbW9kaWZpY2F0aW9uCgogICAgICBpZiAoZS5pbnB1dFR5cGUgIT0gImluc2VydFRleHQiKSB0aGlzLnByb2Nlc3NfY3VycmVudF90ZXh0X3N0eWxlKCk7IC8vIHVwZGF0ZSBjdXJyZW50IHN0eWxlIGlmIGl0IGhhcyBjaGFuZ2VkCiAgICB9LAogICAgLy8gS2V5ZG93biBldmVudAogICAga2V5ZG93bjogZnVuY3Rpb24ga2V5ZG93bihlKSB7CiAgICAgIC8vIGlmIHRoZSBkb2N1bWVudCBpcyBlbXB0eSwgcHJldmVudCByZW1vdmluZyB0aGUgZmlyc3QgcGFnZSBjb250YWluZXIgd2l0aCBhIGJhY2tzcGFjZSBpbnB1dCAoa2V5Y29kZSA4KQogICAgICAvLyB3aGljaCBpcyBub3cgdGhlIGRlZmF1bHQgYmVoYXZpb3IgZm9yIHdlYiBicm93c2VycwogICAgICBpZiAoZS5rZXlDb2RlID09IDggJiYgdGhpcy5jb250ZW50Lmxlbmd0aCA8PSAxKSB7CiAgICAgICAgdmFyIGlzX3RleHQgPSB0aGlzLmNvbnRlbnRbMF0gJiYgdHlwZW9mIHRoaXMuY29udGVudFswXSA9PSAic3RyaW5nIiA/IHRoaXMuY29udGVudFswXS5yZXBsYWNlKC88XHcrKFxzKygiW14iXSoifCdbXiddKid8W14+XSkrKT8+fDxcL1x3Kz4vZ2ksICcnKSA6IGZhbHNlOwogICAgICAgIGlmICghaXNfdGV4dCkgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9LAogICAgLy8gRW1pdCBjb250ZW50IGNoYW5nZSB0byBwYXJlbnQKICAgIGVtaXRfbmV3X2NvbnRlbnQ6IGZ1bmN0aW9uIGVtaXRfbmV3X2NvbnRlbnQoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIHJlbW92ZWRfcGFnZXNfZmxhZyA9IGZhbHNlOyAvLyBmbGFnIHRvIGNhbGwgcmVzZXRfY29udGVudCBpZiBzb21lIHBhZ2VzIHdlcmUgcmVtb3ZlZCBieSB0aGUgdXNlcgogICAgICAvLyBwcm9jZXNzIHRoZSBuZXcgY29udGVudAoKICAgICAgdmFyIG5ld19jb250ZW50ID0gdGhpcy5jb250ZW50Lm1hcChmdW5jdGlvbiAoaXRlbSwgY29udGVudF9pZHgpIHsKICAgICAgICAvLyBzZWxlY3QgcGFnZXMgdGhhdCBjb3JyZXNwb25kIHRvIHRoaXMgY29udGVudCBpdGVtIChyZXByZXNlbnRlZCBieSBpdHMgaW5kZXggaW4gdGhlIGFycmF5KQogICAgICAgIHZhciBwYWdlcyA9IF90aGlzMy5wYWdlcy5maWx0ZXIoZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICAgIHJldHVybiBwYWdlLmNvbnRlbnRfaWR4ID09IGNvbnRlbnRfaWR4OwogICAgICAgIH0pOyAvLyBpZiB0aGVyZSBhcmUgbm8gcGFnZXMgcmVwcmVzZW50aW5nIHRoaXMgY29udGVudCAoYmVjYXVzZSBkZWxldGVkIGJ5IHRoZSB1c2VyKSwgbWFyayBpdGVtIGFzIGZhbHNlIHRvIHJlbW92ZSBpdAoKCiAgICAgICAgaWYgKCFwYWdlcy5sZW5ndGgpIHsKICAgICAgICAgIHJlbW92ZWRfcGFnZXNfZmxhZyA9IHRydWU7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSAvLyBpZiBpdGVtIGlzIGEgc3RyaW5nLCBjb25jYXRlbmF0ZSBlYWNoIHBhZ2UgY29udGVudCBhbmQgc2V0IHRoYXQKICAgICAgICBlbHNlIGlmICh0eXBlb2YgaXRlbSA9PSAic3RyaW5nIikgewogICAgICAgICAgICByZXR1cm4gcGFnZXMubWFwKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgICAgICAgLy8gcmVtb3ZlIGFueSB1c2VsZXNzIDxkaXY+IHN1cnJvdW5kaW5nIHRoZSBjb250ZW50CiAgICAgICAgICAgICAgdmFyIGVsdCA9IHBhZ2UuZWx0OwoKICAgICAgICAgICAgICB3aGlsZSAoZWx0LmNoaWxkcmVuLmxlbmd0aCA9PSAxICYmIGVsdC5maXJzdENoaWxkLnRhZ05hbWUgJiYgZWx0LmZpcnN0Q2hpbGQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICJkaXYiICYmICFlbHQuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoInN0eWxlIikpIHsKICAgICAgICAgICAgICAgIGVsdCA9IGVsdC5maXJzdENoaWxkOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGVsdC5pbm5lckhUTUw7CiAgICAgICAgICAgIH0pLmpvaW4oJycpIHx8IGZhbHNlOwogICAgICAgICAgfSAvLyBpZiBpdGVtIGlzIGEgY29tcG9uZW50LCBqdXN0IGNsb25lIHRoZSBpdGVtCiAgICAgICAgICBlbHNlIHJldHVybiB7CiAgICAgICAgICAgICAgdGVtcGxhdGU6IGl0ZW0udGVtcGxhdGUsCiAgICAgICAgICAgICAgcHJvcHM6IF9vYmplY3RTcHJlYWQoe30sIGl0ZW0ucHJvcHMpCiAgICAgICAgICAgIH07CiAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtICE9IGZhbHNlOwogICAgICB9KTsgLy8gcmVtb3ZlIGVtcHR5IGl0ZW1zCiAgICAgIC8vIGF2b2lkIGNhbGxpbmcgcmVzZXRfY29udGVudCBhZnRlciB0aGUgcGFyZW50IGNvbnRlbnQgaXMgdXBkYXRlZCAoaW5maW5pdGUgbG9vcCkKCiAgICAgIGlmICghcmVtb3ZlZF9wYWdlc19mbGFnKSB0aGlzLnByZXZlbnRfbmV4dF9jb250ZW50X3VwZGF0ZV9mcm9tX3BhcmVudCA9IHRydWU7IC8vIHNlbmQgZXZlbnQgdG8gcGFyZW50IHRvIHVwZGF0ZSB0aGUgc3luY2VkIGNvbnRlbnQKCiAgICAgIHRoaXMuJGVtaXQoInVwZGF0ZTpjb250ZW50IiwgbmV3X2NvbnRlbnQpOwogICAgfSwKICAgIC8vIFNldHMgY3VycmVudF90ZXh0X3N0eWxlIHdpdGggQ1NTIHN0eWxlIGF0IGNhcmV0IHBvc2l0aW9uCiAgICBwcm9jZXNzX2N1cnJlbnRfdGV4dF9zdHlsZTogZnVuY3Rpb24gcHJvY2Vzc19jdXJyZW50X3RleHRfc3R5bGUoKSB7CiAgICAgIHZhciBzdHlsZSA9IGZhbHNlOwogICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpOwoKICAgICAgaWYgKHNlbC5mb2N1c05vZGUpIHsKICAgICAgICB2YXIgZWxlbWVudCA9IHNlbC5mb2N1c05vZGUudGFnTmFtZSA/IHNlbC5mb2N1c05vZGUgOiBzZWwuZm9jdXNOb2RlLnBhcmVudEVsZW1lbnQ7CgogICAgICAgIGlmIChlbGVtZW50ICYmIGVsZW1lbnQuaXNDb250ZW50RWRpdGFibGUpIHsKICAgICAgICAgIHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCk7IC8vIGNvbXB1dGUgYWRkaXRpb25hbCBwcm9wZXJ0aWVzCgogICAgICAgICAgc3R5bGUudGV4dERlY29yYXRpb25TdGFjayA9IFtdOyAvLyBhcnJheSBvZiB0ZXh0LWRlY29yYXRpb24gc3RyaW5ncyBmcm9tIHBhcmVudCBlbGVtZW50cwoKICAgICAgICAgIHN0eWxlLmhlYWRlckxldmVsID0gMDsKICAgICAgICAgIHN0eWxlLmlzTGlzdCA9IGZhbHNlOwogICAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQ7CgogICAgICAgICAgd2hpbGUgKHBhcmVudCkgewogICAgICAgICAgICB2YXIgcGFyZW50X3N0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50KTsgLy8gc3RhY2sgQ1NTIHRleHQtZGVjb3JhdGlvbiBhcyBpdCBpcyBub3Qgb3ZlcnJpZGRlbiBieSBjaGlsZHJlbgoKICAgICAgICAgICAgc3R5bGUudGV4dERlY29yYXRpb25TdGFjay5wdXNoKHBhcmVudF9zdHlsZS50ZXh0RGVjb3JhdGlvbik7IC8vIGNoZWNrIGlmIG9uZSBwYXJlbnQgaXMgYSBsaXN0LWl0ZW0KCiAgICAgICAgICAgIGlmIChwYXJlbnRfc3R5bGUuZGlzcGxheSA9PSAibGlzdC1pdGVtIikgc3R5bGUuaXNMaXN0ID0gdHJ1ZTsgLy8gZ2V0IGZpcnN0IGhlYWRlciBsZXZlbCwgaWYgYW55CgogICAgICAgICAgICBpZiAoIXN0eWxlLmhlYWRlckxldmVsKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gNjsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGFyZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PSAiSCIgKyBpKSB7CiAgICAgICAgICAgICAgICAgIHN0eWxlLmhlYWRlckxldmVsID0gaTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50RWxlbWVudDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudF90ZXh0X3N0eWxlID0gc3R5bGU7CiAgICB9LAogICAgLy8gUHJvY2VzcyB0aGUgc3BlY2lmaWMgc3R5bGUgKHBvc2l0aW9uIGFuZCBzaXplKSBvZiBlYWNoIHBhZ2UgPGRpdj4gYW5kIGNvbnRlbnQgPGRpdj4KICAgIHBhZ2Vfc3R5bGU6IGZ1bmN0aW9uIHBhZ2Vfc3R5bGUocGFnZV9pZHgsIGFsbG93X292ZXJmbG93KSB7CiAgICAgIHZhciBweF9pbl9tbSA9IDAuMjY0NTgzMzMzMzMzMzsKICAgICAgdmFyIHBhZ2Vfd2lkdGggPSB0aGlzLnBhZ2VfZm9ybWF0X21tWzBdIC8gcHhfaW5fbW07CiAgICAgIHZhciBwYWdlX3NwYWNpbmdfbW0gPSAxMDsKICAgICAgdmFyIHBhZ2Vfd2l0aF9wbHVzX3NwYWNpbmcgPSAocGFnZV9zcGFjaW5nX21tICsgdGhpcy5wYWdlX2Zvcm1hdF9tbVswXSkgKiB0aGlzLnpvb20gLyBweF9pbl9tbTsKICAgICAgdmFyIHZpZXdfcGFkZGluZyA9IDIwOwogICAgICB2YXIgaW5uZXJfd2lkdGggPSB0aGlzLmVkaXRvcl93aWR0aCAtIDIgKiB2aWV3X3BhZGRpbmc7CiAgICAgIHZhciBuYl9wYWdlc194ID0gMSwKICAgICAgICAgIHBhZ2VfY29sdW1uLAogICAgICAgICAgeF9wb3MsCiAgICAgICAgICB4X29meCwKICAgICAgICAgIGxlZnRfcHgsCiAgICAgICAgICB0b3BfbW0sCiAgICAgICAgICBia2dfd2lkdGhfbW0sCiAgICAgICAgICBia2dfaGVpZ2h0X21tOwoKICAgICAgaWYgKHRoaXMuZGlzcGxheSA9PSAiaG9yaXpvbnRhbCIpIHsKICAgICAgICBpZiAoaW5uZXJfd2lkdGggPiB0aGlzLnBhZ2VzLmxlbmd0aCAqIHBhZ2Vfd2l0aF9wbHVzX3NwYWNpbmcpIHsKICAgICAgICAgIG5iX3BhZ2VzX3ggPSBNYXRoLmZsb29yKGlubmVyX3dpZHRoIC8gcGFnZV93aXRoX3BsdXNfc3BhY2luZyk7CiAgICAgICAgICBsZWZ0X3B4ID0gaW5uZXJfd2lkdGggLyAobmJfcGFnZXNfeCAqIDIpICogKDEgKyBwYWdlX2lkeCAqIDIpIC0gcGFnZV93aWR0aCAvIDI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5iX3BhZ2VzX3ggPSB0aGlzLnBhZ2VzLmxlbmd0aDsKICAgICAgICAgIGxlZnRfcHggPSBwYWdlX3dpdGhfcGx1c19zcGFjaW5nICogcGFnZV9pZHggKyBwYWdlX3dpZHRoIC8gMiAqICh0aGlzLnpvb20gLSAxKTsKICAgICAgICB9CgogICAgICAgIHRvcF9tbSA9IDA7CiAgICAgICAgYmtnX3dpZHRoX21tID0gdGhpcy56b29tICogKHRoaXMucGFnZV9mb3JtYXRfbW1bMF0gKiBuYl9wYWdlc194ICsgKG5iX3BhZ2VzX3ggLSAxKSAqIHBhZ2Vfc3BhY2luZ19tbSk7CiAgICAgICAgYmtnX2hlaWdodF9tbSA9IHRoaXMucGFnZV9mb3JtYXRfbW1bMV0gKiB0aGlzLnpvb207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImdyaWQiLCB2ZXJ0aWNhbAogICAgICAgIG5iX3BhZ2VzX3ggPSBNYXRoLmZsb29yKGlubmVyX3dpZHRoIC8gcGFnZV93aXRoX3BsdXNfc3BhY2luZyk7CiAgICAgICAgaWYgKG5iX3BhZ2VzX3ggPCAxIHx8IHRoaXMuZGlzcGxheSA9PSAidmVydGljYWwiKSBuYl9wYWdlc194ID0gMTsKICAgICAgICBwYWdlX2NvbHVtbiA9IHBhZ2VfaWR4ICUgbmJfcGFnZXNfeDsKICAgICAgICB4X3BvcyA9IGlubmVyX3dpZHRoIC8gKG5iX3BhZ2VzX3ggKiAyKSAqICgxICsgcGFnZV9jb2x1bW4gKiAyKSAtIHBhZ2Vfd2lkdGggLyAyOwogICAgICAgIHhfb2Z4ID0gTWF0aC5tYXgoMCwgKHBhZ2Vfd2lkdGggKiB0aGlzLnpvb20gLSBpbm5lcl93aWR0aCkgLyAyKTsKICAgICAgICBsZWZ0X3B4ID0geF9wb3MgKyB4X29meDsKICAgICAgICB0b3BfbW0gPSAodGhpcy5wYWdlX2Zvcm1hdF9tbVsxXSArIHBhZ2Vfc3BhY2luZ19tbSkgKiB0aGlzLnpvb20gKiBNYXRoLmZsb29yKHBhZ2VfaWR4IC8gbmJfcGFnZXNfeCk7CiAgICAgICAgdmFyIG5iX3BhZ2VzX3kgPSBNYXRoLmNlaWwodGhpcy5wYWdlcy5sZW5ndGggLyBuYl9wYWdlc194KTsKICAgICAgICBia2dfd2lkdGhfbW0gPSB0aGlzLnpvb20gKiAodGhpcy5wYWdlX2Zvcm1hdF9tbVswXSAqIG5iX3BhZ2VzX3ggKyAobmJfcGFnZXNfeCAtIDEpICogcGFnZV9zcGFjaW5nX21tKTsKICAgICAgICBia2dfaGVpZ2h0X21tID0gdGhpcy56b29tICogKHRoaXMucGFnZV9mb3JtYXRfbW1bMV0gKiBuYl9wYWdlc195ICsgKG5iX3BhZ2VzX3kgLSAxKSAqIHBhZ2Vfc3BhY2luZ19tbSk7CiAgICAgIH0KCiAgICAgIGlmIChwYWdlX2lkeCA+PSAwKSB7CiAgICAgICAgdmFyIHN0eWxlID0gewogICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICBsZWZ0OiAiY2FsYygiICsgbGVmdF9weCArICJweCArICIgKyB2aWV3X3BhZGRpbmcgKyAicHgpIiwKICAgICAgICAgIHRvcDogImNhbGMoIiArIHRvcF9tbSArICJtbSArICIgKyB2aWV3X3BhZGRpbmcgKyAicHgpIiwKICAgICAgICAgIHdpZHRoOiB0aGlzLnBhZ2VfZm9ybWF0X21tWzBdICsgIm1tIiwKICAgICAgICAgIC8vICJoZWlnaHQiIGlzIHNldCBiZWxvdwogICAgICAgICAgcGFkZGluZzogdHlwZW9mIHRoaXMucGFnZV9tYXJnaW5zID09ICJmdW5jdGlvbiIgPyB0aGlzLnBhZ2VfbWFyZ2lucyhwYWdlX2lkeCArIDEsIHRoaXMucGFnZXMubGVuZ3RoKSA6IHRoaXMucGFnZV9tYXJnaW5zLAogICAgICAgICAgdHJhbnNmb3JtOiAic2NhbGUoIiArIHRoaXMuem9vbSArICIpIgogICAgICAgIH07CiAgICAgICAgc3R5bGVbYWxsb3dfb3ZlcmZsb3cgPyAibWluSGVpZ2h0IiA6ICJoZWlnaHQiXSA9IHRoaXMucGFnZV9mb3JtYXRfbW1bMV0gKyAibW0iOwogICAgICAgIHJldHVybiBzdHlsZTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDb250ZW50L2JhY2tncm91bmQgPGRpdj4gaXMgc2l6ZWQgc28gaXQgbGV0cyBhIG1hcmdpbiBhcm91bmQgcGFnZXMgd2hlbiBzY3JvbGxpbmcgYXQgdGhlIGVuZAogICAgICAgIHJldHVybiB7CiAgICAgICAgICB3aWR0aDogImNhbGMoIiArIGJrZ193aWR0aF9tbSArICJtbSArICIgKyAyICogdmlld19wYWRkaW5nICsgInB4KSIsCiAgICAgICAgICBoZWlnaHQ6ICJjYWxjKCIgKyBia2dfaGVpZ2h0X21tICsgIm1tICsgIiArIDIgKiB2aWV3X3BhZGRpbmcgKyAicHgpIgogICAgICAgIH07CiAgICAgIH0KICAgIH0sCiAgICAvLyBVdGlsaXR5IHRvIGNvbnZlcnQgcGFnZV9zdHlsZSB0byBDU1Mgc3RyaW5nCiAgICBjc3NfdG9fc3RyaW5nOiBmdW5jdGlvbiBjc3NfdG9fc3RyaW5nKGNzcykgewogICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoY3NzKS5tYXAoZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAyKSwKICAgICAgICAgICAgayA9IF9yZWYyWzBdLAogICAgICAgICAgICB2ID0gX3JlZjJbMV07CgogICAgICAgIHJldHVybiBrLnJlcGxhY2UoL1tBLVpdL2csIGZ1bmN0aW9uIChtYXRjaCkgewogICAgICAgICAgcmV0dXJuICItIiArIG1hdGNoLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfSkgKyAiOiIgKyB2OwogICAgICB9KS5qb2luKCc7Jyk7CiAgICB9LAogICAgLy8gVXBkYXRlIHBhZ2VzIDxkaXY+IGZyb20gdGhpcy5wYWdlcyBkYXRhCiAgICB1cGRhdGVfcGFnZXNfZWx0czogZnVuY3Rpb24gdXBkYXRlX3BhZ2VzX2VsdHMoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgLy8gUmVtb3ZpbmcgZGVsZXRlZCBwYWdlcwogICAgICB2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuJHJlZnMuY29udGVudC5jaGlsZHJlbiksCiAgICAgICAgICBfc3RlcDM7CgogICAgICB0cnkgewogICAgICAgIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoKSB7CiAgICAgICAgICB2YXIgcGFnZV9lbHQgPSBfc3RlcDMudmFsdWU7CiAgICAgICAgICBpZiAoIV90aGlzNC5wYWdlcy5maW5kKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgICAgIHJldHVybiBwYWdlLmVsdCA9PSBwYWdlX2VsdDsKICAgICAgICAgIH0pKSBwYWdlX2VsdC5yZW1vdmUoKTsKICAgICAgICB9OwoKICAgICAgICBmb3IgKF9pdGVyYXRvcjMucygpOyAhKF9zdGVwMyA9IF9pdGVyYXRvcjMubigpKS5kb25lOykgewogICAgICAgICAgX2xvb3AyKCk7CiAgICAgICAgfSAvLyBBZGRpbmcgLyB1cGRhdGluZyBwYWdlcwoKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgIH0KCiAgICAgIHZhciBfaXRlcmF0b3I0ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5wYWdlcy5lbnRyaWVzKCkpLAogICAgICAgICAgX3N0ZXA0OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9zdGVwNCR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwNC52YWx1ZSwgMiksCiAgICAgICAgICAgICAgcGFnZV9pZHggPSBfc3RlcDQkdmFsdWVbMF0sCiAgICAgICAgICAgICAgcGFnZSA9IF9zdGVwNCR2YWx1ZVsxXTsKCiAgICAgICAgICAvLyBHZXQgZWl0aGVyIGV4aXN0aW5nIHBhZ2VfZWx0IG9yIGNyZWF0ZSBpdAogICAgICAgICAgaWYgKCFwYWdlLmVsdCkgewogICAgICAgICAgICBwYWdlLmVsdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBwYWdlLmVsdC5jbGFzc05hbWUgPSAicGFnZSI7CiAgICAgICAgICAgIHBhZ2UuZWx0LmRhdGFzZXQuaXNWREVQYWdlID0gIiI7CiAgICAgICAgICAgIHZhciBuZXh0X3BhZ2UgPSB0aGlzLnBhZ2VzW3BhZ2VfaWR4ICsgMV07CiAgICAgICAgICAgIHRoaXMuJHJlZnMuY29udGVudC5pbnNlcnRCZWZvcmUocGFnZS5lbHQsIG5leHRfcGFnZSA/IG5leHRfcGFnZS5lbHQgOiBudWxsKTsKICAgICAgICAgIH0gLy8gVXBkYXRlIHBhZ2UgcHJvcGVydGllcwoKCiAgICAgICAgICBwYWdlLmVsdC5kYXRhc2V0LmNvbnRlbnRJZHggPSBwYWdlLmNvbnRlbnRfaWR4OwogICAgICAgICAgaWYgKCF0aGlzLnByaW50aW5nX21vZGUpIHBhZ2UuZWx0LnN0eWxlID0gT2JqZWN0LmVudHJpZXModGhpcy5wYWdlX3N0eWxlKHBhZ2VfaWR4LCBwYWdlLnRlbXBsYXRlID8gZmFsc2UgOiB0cnVlKSkubWFwKGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgICAgICB2YXIgX3JlZjQgPSBfc2xpY2VkVG9BcnJheShfcmVmMywgMiksCiAgICAgICAgICAgICAgICBrID0gX3JlZjRbMF0sCiAgICAgICAgICAgICAgICB2ID0gX3JlZjRbMV07CgogICAgICAgICAgICByZXR1cm4gay5yZXBsYWNlKC9bQS1aXS9nLCBmdW5jdGlvbiAobWF0Y2gpIHsKICAgICAgICAgICAgICByZXR1cm4gIi0iICsgbWF0Y2gudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfSkgKyAiOiIgKyB2OwogICAgICAgICAgfSkuam9pbignOycpOyAvLyAoY29udmVydCBwYWdlX3N0eWxlIHRvIENTUyBzdHJpbmcpCgogICAgICAgICAgcGFnZS5lbHQuY29udGVudEVkaXRhYmxlID0gdGhpcy5lZGl0YWJsZSAmJiAhcGFnZS50ZW1wbGF0ZSA/IHRydWUgOiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjQuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjQuZigpOwogICAgICB9CiAgICB9LAogICAgLy8gR2V0IGFuZCBzdG9yZSBlbXB0eSBlZGl0b3IgPGRpdj4gd2lkdGgKICAgIHVwZGF0ZV9lZGl0b3Jfd2lkdGg6IGZ1bmN0aW9uIHVwZGF0ZV9lZGl0b3Jfd2lkdGgoKSB7CiAgICAgIHRoaXMuJHJlZnMuZWRpdG9yLmNsYXNzTGlzdC5hZGQoImhpZGVfY2hpbGRyZW4iKTsKICAgICAgdGhpcy5lZGl0b3Jfd2lkdGggPSB0aGlzLiRyZWZzLmVkaXRvci5jbGllbnRXaWR0aDsKICAgICAgdGhpcy51cGRhdGVfcGFnZXNfZWx0cygpOwogICAgICB0aGlzLiRyZWZzLmVkaXRvci5jbGFzc0xpc3QucmVtb3ZlKCJoaWRlX2NoaWxkcmVuIik7CiAgICB9LAogICAgdXBkYXRlX2Nzc19tZWRpYV9zdHlsZTogZnVuY3Rpb24gdXBkYXRlX2Nzc19tZWRpYV9zdHlsZSgpIHsKICAgICAgdGhpcy5jc3NfbWVkaWFfc3R5bGUuaW5uZXJIVE1MID0gIkBtZWRpYSBwcmludCB7IEBwYWdlIHsgc2l6ZTogIiArIHRoaXMucGFnZV9mb3JtYXRfbW1bMF0gKyAibW0gIiArIHRoaXMucGFnZV9mb3JtYXRfbW1bMV0gKyAibW07IG1hcmdpbjogMCAhaW1wb3J0YW50OyB9IC5oaWRkZW4tcHJpbnQgeyBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7IH0gfSI7CiAgICB9LAogICAgLy8gUHJlcGFyZSBjb250ZW50IGJlZm9yZSBvcGVuaW5nIHRoZSBuYXRpdmUgcHJpbnQgYm94CiAgICBiZWZvcmVfcHJpbnQ6IGZ1bmN0aW9uIGJlZm9yZV9wcmludCgpIHsKICAgICAgLy8gc2V0IHRoZSBwcmludGluZyBtb2RlIGZsYWcKICAgICAgdGhpcy5wcmludGluZ19tb2RlID0gdHJ1ZTsgLy8gc3RvcmUgdGhlIGN1cnJlbnQgYm9keSBhc2lkZQoKICAgICAgdGhpcy5fcGFnZV9ib2R5ID0gZG9jdW1lbnQuYm9keTsgLy8gY3JlYXRlIGEgbmV3IGJvZHkgZm9yIHRoZSBwcmludCBhbmQgb3ZlcndyaXRlIENTUwoKICAgICAgdmFyIHByaW50X2JvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJib2R5Iik7CiAgICAgIHByaW50X2JvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBwcmludF9ib2R5LnN0eWxlLnBhZGRpbmcgPSAiMCI7CiAgICAgIHByaW50X2JvZHkuc3R5bGUuYmFja2dyb3VuZCA9ICJ3aGl0ZSI7CiAgICAgIHByaW50X2JvZHkuc3R5bGUuZm9udCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuJHJlZnMuZWRpdG9yKS5mb250OwogICAgICBwcmludF9ib2R5LmNsYXNzTmFtZSA9IHRoaXMuJHJlZnMuZWRpdG9yLmNsYXNzTmFtZTsgLy8gbW92ZSBlYWNoIHBhZ2UgdG8gdGhlIHByaW50IGJvZHkKCiAgICAgIHZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5wYWdlcy5lbnRyaWVzKCkpLAogICAgICAgICAgX3N0ZXA1OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjUucygpOyAhKF9zdGVwNSA9IF9pdGVyYXRvcjUubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9zdGVwNSR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwNS52YWx1ZSwgMiksCiAgICAgICAgICAgICAgcGFnZV9pZHggPSBfc3RlcDUkdmFsdWVbMF0sCiAgICAgICAgICAgICAgcGFnZSA9IF9zdGVwNSR2YWx1ZVsxXTsKCiAgICAgICAgICAvL2NvbnN0IHBhZ2VfY2xvbmUgPSBwYWdlX2VsdC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICBwYWdlLmVsdC5zdHlsZSA9ICIiOyAvLyByZXNldCBwYWdlIHN0eWxlIGZvciB0aGUgY2xvbmUKCiAgICAgICAgICBwYWdlLmVsdC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CiAgICAgICAgICBwYWdlLmVsdC5zdHlsZS5wYWRkaW5nID0gdHlwZW9mIHRoaXMucGFnZV9tYXJnaW5zID09ICJmdW5jdGlvbiIgPyB0aGlzLnBhZ2VfbWFyZ2lucyhwYWdlX2lkeCArIDEsIHRoaXMucGFnZXMubGVuZ3RoKSA6IHRoaXMucGFnZV9tYXJnaW5zOwogICAgICAgICAgcGFnZS5lbHQuc3R5bGUuYnJlYWtCZWZvcmUgPSBwYWdlX2lkeCA/ICJwYWdlIiA6ICJhdXRvIjsgLy8gYWRkIG92ZXJsYXlzIGlmIGFueQoKICAgICAgICAgIHZhciBvdmVybGF5X2VsdCA9IHRoaXMucGFnZXNfb3ZlcmxheV9yZWZzW3BhZ2UudXVpZF07CgogICAgICAgICAgaWYgKG92ZXJsYXlfZWx0KSB7CiAgICAgICAgICAgIG92ZXJsYXlfZWx0LnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgICAgICAgICAgb3ZlcmxheV9lbHQuc3R5bGUubGVmdCA9ICIwIjsKICAgICAgICAgICAgb3ZlcmxheV9lbHQuc3R5bGUudG9wID0gIjAiOwogICAgICAgICAgICBvdmVybGF5X2VsdC5zdHlsZS50cmFuc2Zvcm0gPSAibm9uZSI7CiAgICAgICAgICAgIG92ZXJsYXlfZWx0LnN0eWxlLnBhZGRpbmcgPSAiMCI7CiAgICAgICAgICAgIG92ZXJsYXlfZWx0LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgICAgICAgIHBhZ2UuZWx0LnByZXBlbmQob3ZlcmxheV9lbHQpOwogICAgICAgICAgfQoKICAgICAgICAgIHByaW50X2JvZHkuYXBwZW5kKHBhZ2UuZWx0KTsKICAgICAgICB9IC8vIGRpc3BsYXkgYSByZXR1cm4gYXJyb3cgdG8gbGV0IHRoZSB1c2VyIHJlc3RvcmUgdGhlIG9yaWdpbmFsIGJvZHkgaW4gY2FzZSB0aGUgbmF2aWdhdG9yIGRvZXNuJ3QgY2FsbCBhZnRlcl9wcmludCgpIChpdCBoYXBwZW5zIHNvbWV0aW1lcyBpbiBDaHJvbWUpCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I1LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I1LmYoKTsKICAgICAgfQoKICAgICAgdmFyIHJldHVybl9vdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIHJldHVybl9vdmVybGF5LmNsYXNzTmFtZSA9ICJoaWRkZW4tcHJpbnQiOyAvLyBjc3MgbWFuYWdlZCBpbiB1cGRhdGVfY3NzX21lZGlhX3N0eWxlIG1ldGhvZAoKICAgICAgcmV0dXJuX292ZXJsYXkuc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiOwogICAgICByZXR1cm5fb3ZlcmxheS5zdHlsZS5sZWZ0ID0gIjAiOwogICAgICByZXR1cm5fb3ZlcmxheS5zdHlsZS50b3AgPSAiMCI7CiAgICAgIHJldHVybl9vdmVybGF5LnN0eWxlLnJpZ2h0ID0gIjAiOwogICAgICByZXR1cm5fb3ZlcmxheS5zdHlsZS5ib3R0b20gPSAiMCI7CiAgICAgIHJldHVybl9vdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICAgIHJldHVybl9vdmVybGF5LnN0eWxlLmFsaWduSXRlbXMgPSAiY2VudGVyIjsKICAgICAgcmV0dXJuX292ZXJsYXkuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAiY2VudGVyIjsKICAgICAgcmV0dXJuX292ZXJsYXkuc3R5bGUuYmFja2dyb3VuZCA9ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOTUpIjsKICAgICAgcmV0dXJuX292ZXJsYXkuc3R5bGUuY3Vyc29yID0gInBvaW50ZXIiOwogICAgICByZXR1cm5fb3ZlcmxheS5pbm5lckhUTUwgPSAnPHN2ZyB3aWR0aD0iMjIwIiBoZWlnaHQ9IjIyMCI+PHBhdGggZmlsbD0icmdiYSgwLCAwLCAwLCAwLjcpIiBkPSJNMTIwLjc3NCwxNzkuMjcxdjQwYzQ3LjMwMywwLDg1Ljc4NC0zOC40ODIsODUuNzg0LTg1Ljc4NWMwLTQ3LjMtMzguNDgxLTg1Ljc4Mi04NS43ODQtODUuNzgySDg5LjI4MkwxMDguNywyOC4yODZMODAuNDE3LDBMMTIuNzEzLDY3LjcwM2w2Ny43MDMsNjcuNzAxbDI4LjI4My0yOC4yODRMODkuMjgyLDg3LjcwM2gzMS40OTJjMjUuMjQ2LDAsNDUuNzg0LDIwLjUzOCw0NS43ODQsNDUuNzgzQzE2Ni41NTgsMTU4LjczLDE0Ni4wMiwxNzkuMjcxLDEyMC43NzQsMTc5LjI3MXoiLz48L3N2Zz4nOwogICAgICByZXR1cm5fb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuYWZ0ZXJfcHJpbnQpOwogICAgICBwcmludF9ib2R5LmFwcGVuZChyZXR1cm5fb3ZlcmxheSk7IC8vIHJlcGxhY2UgY3VycmVudCBib2R5IGJ5IHRoZSBwcmludCBib2R5CgogICAgICBkb2N1bWVudC5ib2R5ID0gcHJpbnRfYm9keTsKICAgIH0sCiAgICAvLyBSZXN0b3JlIGNvbnRlbnQgYWZ0ZXIgY2xvc2luZyB0aGUgbmF0aXZlIHByaW50IGJveAogICAgYWZ0ZXJfcHJpbnQ6IGZ1bmN0aW9uIGFmdGVyX3ByaW50KCkgewogICAgICAvLyBjbGVhciB0aGUgcHJpbnRpbmcgbW9kZSBmbGFnCiAgICAgIHRoaXMucHJpbnRpbmdfbW9kZSA9IGZhbHNlOyAvLyByZXN0b3JlIHBhZ2VzIGFuZCBvdmVybGF5cwoKICAgICAgdmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLnBhZ2VzLmVudHJpZXMoKSksCiAgICAgICAgICBfc3RlcDY7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yNi5zKCk7ICEoX3N0ZXA2ID0gX2l0ZXJhdG9yNi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX3N0ZXA2JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXA2LnZhbHVlLCAyKSwKICAgICAgICAgICAgICBwYWdlX2lkeCA9IF9zdGVwNiR2YWx1ZVswXSwKICAgICAgICAgICAgICBwYWdlID0gX3N0ZXA2JHZhbHVlWzFdOwoKICAgICAgICAgIHBhZ2UuZWx0LnN0eWxlID0gdGhpcy5jc3NfdG9fc3RyaW5nKHRoaXMucGFnZV9zdHlsZShwYWdlX2lkeCwgcGFnZS50ZW1wbGF0ZSA/IGZhbHNlIDogdHJ1ZSkpOwogICAgICAgICAgdGhpcy4kcmVmcy5jb250ZW50LmFwcGVuZChwYWdlLmVsdCk7CiAgICAgICAgICB2YXIgb3ZlcmxheV9lbHQgPSB0aGlzLnBhZ2VzX292ZXJsYXlfcmVmc1twYWdlLnV1aWRdOwoKICAgICAgICAgIGlmIChvdmVybGF5X2VsdCkgewogICAgICAgICAgICBvdmVybGF5X2VsdC5zdHlsZSA9IHRoaXMuY3NzX3RvX3N0cmluZyh0aGlzLnBhZ2Vfc3R5bGUocGFnZV9pZHgsIGZhbHNlKSk7CiAgICAgICAgICAgIHRoaXMuJHJlZnMub3ZlcmxheXMuYXBwZW5kKG92ZXJsYXlfZWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjYuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjYuZigpOwogICAgICB9CgogICAgICBkb2N1bWVudC5ib2R5ID0gdGhpcy5fcGFnZV9ib2R5OyAvLyByZWNvbXB1dGUgZWRpdG9yIHdpdGggYW5kIHJlcG9zaXRpb24gZWxlbWVudHMKCiAgICAgIHRoaXMudXBkYXRlX2VkaXRvcl93aWR0aCgpOwogICAgfQogIH0sCiAgLy8gV2F0Y2ggZm9yIGNoYW5nZXMgYW5kIGFkYXB0IGNvbnRlbnQgYWNjb3JkaW5nbHkKICB3YXRjaDogewogICAgY29udGVudDogewogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKCkgewogICAgICAgIC8vIHByZXZlbnQgaW5maW5pdGUgbG9vcCBhcyByZXNldF9jb250ZW50IHRyaWdnZXJzIGEgY29udGVudCB1cGRhdGUgYW5kIGl0J3MgYXN5bmMKICAgICAgICBpZiAodGhpcy5wcmV2ZW50X25leHRfY29udGVudF91cGRhdGVfZnJvbV9wYXJlbnQpIHsKICAgICAgICAgIHRoaXMucHJldmVudF9uZXh0X2NvbnRlbnRfdXBkYXRlX2Zyb21fcGFyZW50ID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHRoaXMucmVzZXRfY29udGVudCgpOwogICAgICB9LAogICAgICBkZWVwOiB0cnVlCiAgICB9LAogICAgZGlzcGxheTogewogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKCkgewogICAgICAgIHRoaXMudXBkYXRlX3BhZ2VzX2VsdHMoKTsKICAgICAgfQogICAgfSwKICAgIHBhZ2VfZm9ybWF0X21tOiB7CiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIoKSB7CiAgICAgICAgdGhpcy51cGRhdGVfY3NzX21lZGlhX3N0eWxlKCk7CiAgICAgICAgdGhpcy5yZXNldF9jb250ZW50KCk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdlX21hcmdpbnM6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcigpIHsKICAgICAgICB0aGlzLnJlc2V0X2NvbnRlbnQoKTsKICAgICAgfQogICAgfSwKICAgIHpvb206IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcigpIHsKICAgICAgICB0aGlzLnVwZGF0ZV9wYWdlc19lbHRzKCk7CiAgICAgIH0KICAgIH0KICB9Cn07"},{"version":3,"sources":["F:\\SVN PROJECTS\\ERP_Hospital_Client\\trunk\\node_modules\\vue-document-editor\\src\\DocumentEditor\\DocumentEditor.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"editor\" ref=\"editor\">\n\n    <!-- Page overlays (headers, footers, page numbers, ...) -->\n    <div v-if=\"overlay\" class=\"overlays\" ref=\"overlays\">\n      <div v-for=\"(page, page_idx) in pages\" class=\"overlay\" :key=\"page.uuid+'-overlay'\" :ref=\"(elt) => (pages_overlay_refs[page.uuid] = elt)\"\n        v-html=\"overlay(page_idx+1, pages.length)\" :style=\"page_style(page_idx, false)\">\n      </div>\n    </div>\n\n    <!-- Document editor -->\n    <div class=\"content\" ref=\"content\" :contenteditable=\"editable\" :style=\"page_style(-1)\" @input=\"input\" @keyup=\"process_current_text_style\" @keydown=\"keydown\">\n      <!-- This is a Vue \"hoisted\" static <div> which contains every page of the document and can be modified by the DOM -->\n    </div>\n\n    <!-- Items related to the document editor (widgets, ...) can be inserted here -->\n\n  </div>\n</template>\n\n<script>\nimport { defineCustomElement } from 'vue';\nimport { move_children_forward_recursively, move_children_backwards_with_merging } from './imports/page-transition-mgmt.js';\n\nexport default {\n\n  props: {\n    // This contains the initial content of the document that can be synced\n    // It must be an Array: each array item is a new set of pages containing the\n    // item (string or component). You can see that as predefined page breaks.\n    // See the Demo.vue file for a good usage example.\n    content: {\n      type: Array,\n      required: true\n    },\n\n    // Display mode of the pages\n    display: {\n      type: String,\n      default: \"grid\" // [\"grid\", \"horizontal\", \"vertical\"]\n    },\n\n    // Sets whether document text can be modified\n    editable: {\n      type: Boolean,\n      default: true\n    },\n\n    // Overlay function returning page headers and footers in HTML\n    overlay: Function,\n\n    // Pages format in mm (should be an array containing [width, height])\n    page_format_mm: {\n      type: Array,\n      default: () => [210, 297]\n    },\n\n    // Page margins in CSS\n    page_margins: {\n      type: [String, Function],\n      default: \"10mm 15mm\"\n    },\n\n    // Display zoom. Only acts on the screen display\n    zoom: {\n      type: Number,\n      default: 1.0\n    }\n  },\n\n  data () {\n    return {\n      pages: [], // contains {uuid, content_idx, prev_html, template, props, elt} for each pages of the document\n      pages_overlay_refs: {}, // contains page overlay ref elements indexed by uuid\n      pages_height: 0, // real measured page height in px (corresponding to page_format_mm[1])\n      editor_width: 0, // real measured with of an empty editor <div> in px\n      prevent_next_content_update_from_parent: false, // workaround to avoid infinite update loop\n      current_text_style: false, // contains the style at caret position\n      printing_mode: false, // flag set when page is rendering in printing mode\n    }\n  },\n\n  mounted () {\n    this.update_editor_width();\n    this.update_css_media_style();\n    this.reset_content();\n    window.addEventListener(\"resize\", this.update_editor_width);\n    window.addEventListener(\"click\", this.process_current_text_style);\n    window.addEventListener(\"beforeprint\", this.before_print);\n    window.addEventListener(\"afterprint\", this.after_print);\n  },\n\n  beforeUpdate () {\n    this.pages_overlay_refs = [];\n  },\n\n  beforeUnmount () {\n    window.removeEventListener(\"resize\", this.update_editor_width);\n    window.removeEventListener(\"click\", this.process_current_text_style);\n    window.removeEventListener(\"beforeprint\", this.before_print);\n    window.removeEventListener(\"afterprint\", this.after_print);\n  },\n\n  computed: {\n    css_media_style () { // creates a CSS <style> and returns it\n      const style = document.createElement(\"style\");\n      document.head.appendChild(style);\n      return style;\n    }\n  },\n\n\n  methods: {\n    // Computes a random 5-char UUID\n    new_uuid: () => Math.random().toString(36).slice(-5),\n\n    // Resets all content from the content property\n    reset_content () {\n      // Prevent launching this function multiple times\n      if(this.reset_in_progress) return;\n      this.reset_in_progress = true;\n\n      // If provided content is empty, initialize it first and exit\n      if(!this.content.length) {\n        this.reset_in_progress = false;\n        this.$emit(\"update:content\", [\"\"]);\n        return;\n      }\n\n      // Delete all pages and set one new page per content item\n      this.pages = this.content.map((content, content_idx) => ({\n        uuid: this.new_uuid(),\n        content_idx,\n        template: content.template,\n        props: content.props\n      }));\n      this.update_pages_elts();\n\n      // Get page height from first empty page\n      const first_page_elt = this.pages[0].elt;\n      if(!this.$refs.content.contains(first_page_elt)) this.$refs.content.appendChild(first_page_elt); // restore page in DOM in case it was removed\n      this.pages_height = first_page_elt.clientHeight + 1; // allow one pixel precision\n\n      // Initialize text pages\n      for(const page of this.pages) {\n\n        // set raw HTML content\n        if(!this.content[page.content_idx]) page.elt.innerHTML = \"<div><br></div>\";\n        else if(typeof this.content[page.content_idx] == \"string\") page.elt.innerHTML = \"<div>\"+this.content[page.content_idx]+\"</div>\";\n        else if(page.template) {\n          const componentElement = defineCustomElement(page.template);\n          customElements.define('component-'+page.uuid, componentElement);\n          page.elt.appendChild(new componentElement({ modelValue: page.props }));\n        }\n\n        // restore page in DOM in case it was removed\n        if(!this.$refs.content.contains(page.elt)) this.$refs.content.appendChild(page.elt);\n      }\n\n      // Spread content over several pages if it overflows\n      this.fit_content_over_pages();\n\n      // Remove the text cursor from the content, if any (its position is lost anyway)\n      this.$refs.content.blur();\n\n      // Clear \"reset in progress\" flag\n      this.reset_in_progress = false;\n    },\n\n    // Spreads the HTML content over several pages until it fits\n    fit_content_over_pages () {\n      // Data variable this.pages_height must have been set before calling this function\n      if(!this.pages_height) return;\n\n      // Prevent launching this function multiple times\n      if(this.fit_in_progress) return;\n      this.fit_in_progress = true;\n\n      // Check pages that were deleted from the DOM (start from the end)\n      for(let page_idx = this.pages.length - 1; page_idx >= 0; page_idx--) {\n        const page = this.pages[page_idx];\n\n        // if user deleted the page from the DOM, then remove it from this.pages array\n        if(!page.elt || !document.body.contains(page.elt)) this.pages.splice(page_idx, 1);\n      }\n\n      // If all the document was wiped out, start a new empty document\n      if(!this.pages.length){\n        this.$emit(\"update:content\", [\"\"]);\n        return;\n      }\n\n      // Save current selection (or cursor position) by inserting empty HTML elements at the start and the end of it\n      const selection = window.getSelection();\n      const start_marker = document.createElement(\"null\");\n      const end_marker = document.createElement(\"null\");\n      // don't insert markers in case selection fails (if we are editing in components in the shadow-root it selects the page <div> as anchorNode)\n      if(selection && selection.rangeCount && selection.anchorNode && !(selection.anchorNode.dataset && selection.anchorNode.dataset.isVDEPage != null)) {\n        const range = selection.getRangeAt(0);\n        range.insertNode(start_marker);\n        range.collapse(false);\n        range.insertNode(end_marker);\n      }\n\n      // Browse every remaining page\n      let prev_page_modified_flag = false;\n      for(let page_idx = 0; page_idx < this.pages.length; page_idx++) { // page length can grow inside this loop\n        const page = this.pages[page_idx];\n        let next_page = this.pages[page_idx + 1];\n        let next_page_elt = next_page ? next_page.elt : null;\n\n        // check if this page, the next page, or any previous page content has been modified by the user (don't apply to template pages)\n        if(!page.template && (prev_page_modified_flag || page.elt.innerHTML != page.prev_innerHTML\n          || (next_page_elt && !next_page.template && next_page_elt.innerHTML != next_page.prev_innerHTML))){\n          prev_page_modified_flag = true;\n\n          // BACKWARD-PROPAGATION\n          // check if content doesn't overflow, and that next page exists and has the same content_idx\n          if(page.elt.clientHeight <= this.pages_height && next_page && next_page.content_idx == page.content_idx) {\n\n            // try to append every node from the next page until it doesn't fit\n            move_children_backwards_with_merging(page.elt, next_page_elt, () => !next_page_elt.childNodes.length || (page.elt.clientHeight > this.pages_height));\n          }\n\n          // FORWARD-PROPAGATION\n          // check if content overflows\n          if(page.elt.clientHeight > this.pages_height) {\n\n            // if there is no next page for the same content, create it\n            if(!next_page || next_page.content_idx != page.content_idx) {\n              next_page = { uuid: this.new_uuid(), content_idx: page.content_idx };\n              this.pages.splice(page_idx + 1, 0, next_page);\n              this.update_pages_elts();\n              next_page_elt = next_page.elt;\n            }\n\n            // move the content step by step to the next page, until it fits\n            move_children_forward_recursively(page.elt, next_page_elt, () => (page.elt.clientHeight <= this.pages_height));\n          }\n\n          // CLEANING\n          // remove next page if it is empty\n          if(next_page_elt && next_page.content_idx == page.content_idx && !next_page_elt.childNodes.length) {\n            this.pages.splice(page_idx + 1, 1);\n          }\n        }\n\n        // update pages in the DOM\n        this.update_pages_elts();\n      }\n      \n\n      // Restore selection and remove empty elements\n      if(document.body.contains(start_marker)){\n        const range = document.createRange();\n        range.setStart(start_marker, 0);\n        if(document.body.contains(end_marker)) range.setEnd(end_marker, 0);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n      if(start_marker.parentElement) start_marker.parentElement.removeChild(start_marker);\n      if(end_marker.parentElement) end_marker.parentElement.removeChild(end_marker);\n\n      // Normalize and store current page HTML content\n      for(const page of this.pages) {\n        if(!page.template) page.elt.normalize(); // normalize HTML (merge text nodes) - don't touch template pages or it can break Vue\n        page.prev_innerHTML = page.elt.innerHTML; // store current pages innerHTML for next call\n      }\n\n      // Clear \"fit in progress\" flag\n      this.fit_in_progress = false;\n    },\n\n    // Input event\n    input (e) {\n      if(!e) return; // check that event is set\n      this.fit_content_over_pages(); // fit content according to modifications\n      this.emit_new_content(); // emit content modification\n      if(e.inputType != \"insertText\") this.process_current_text_style(); // update current style if it has changed\n    },\n\n    // Keydown event\n    keydown (e) {\n      // if the document is empty, prevent removing the first page container with a backspace input (keycode 8)\n      // which is now the default behavior for web browsers\n      if(e.keyCode == 8 && this.content.length <= 1) {\n        const is_text = (this.content[0] && typeof(this.content[0]) == \"string\") ? this.content[0].replace(/<\\w+(\\s+(\"[^\"]*\"|'[^']*'|[^>])+)?>|<\\/\\w+>/gi, '') : false;\n        if(!is_text) e.preventDefault();\n      }\n    },\n\n    // Emit content change to parent\n    emit_new_content () {\n      let removed_pages_flag = false; // flag to call reset_content if some pages were removed by the user\n\n      // process the new content\n      const new_content = this.content.map((item, content_idx) => {\n        // select pages that correspond to this content item (represented by its index in the array)\n        const pages = this.pages.filter(page => (page.content_idx == content_idx));\n\n        // if there are no pages representing this content (because deleted by the user), mark item as false to remove it\n        if(!pages.length) {\n          removed_pages_flag = true;\n          return false;\n        }\n        // if item is a string, concatenate each page content and set that\n        else if(typeof item == \"string\") {\n          return pages.map(page => {\n            // remove any useless <div> surrounding the content\n            let elt = page.elt;\n            while(elt.children.length == 1 && elt.firstChild.tagName && elt.firstChild.tagName.toLowerCase() == \"div\" && !elt.firstChild.getAttribute(\"style\")) {\n              elt = elt.firstChild;\n            }\n            return elt.innerHTML;\n          }).join('') || false;\n        }\n        // if item is a component, just clone the item\n        else return { template: item.template, props: { ...item.props }};\n      }).filter(item => (item != false)); // remove empty items\n\n      // avoid calling reset_content after the parent content is updated (infinite loop)\n      if(!removed_pages_flag) this.prevent_next_content_update_from_parent = true;\n\n      // send event to parent to update the synced content\n      this.$emit(\"update:content\", new_content);\n    },\n\n    // Sets current_text_style with CSS style at caret position\n    process_current_text_style () {\n      let style = false;\n      const sel = window.getSelection();\n      if(sel.focusNode) {\n        const element = sel.focusNode.tagName ? sel.focusNode : sel.focusNode.parentElement;\n        if(element && element.isContentEditable) {\n          style = window.getComputedStyle(element);\n\n          // compute additional properties\n          style.textDecorationStack = []; // array of text-decoration strings from parent elements\n          style.headerLevel = 0;\n          style.isList = false;\n          let parent = element;\n          while(parent){\n            const parent_style = window.getComputedStyle(parent);\n            // stack CSS text-decoration as it is not overridden by children\n            style.textDecorationStack.push(parent_style.textDecoration);\n            // check if one parent is a list-item\n            if(parent_style.display == \"list-item\") style.isList = true;\n            // get first header level, if any\n            if(!style.headerLevel){\n              for(let i = 1; i <= 6; i++){\n                if(parent.tagName.toUpperCase() == \"H\"+i) {\n                  style.headerLevel = i;\n                  break;\n                }\n              }\n            }\n            parent = parent.parentElement;\n          }\n        }\n      }\n      this.current_text_style = style;\n    },\n\n    // Process the specific style (position and size) of each page <div> and content <div>\n    page_style (page_idx, allow_overflow) {\n      const px_in_mm = 0.2645833333333;\n      const page_width = this.page_format_mm[0] / px_in_mm;\n      const page_spacing_mm = 10;\n      const page_with_plus_spacing = (page_spacing_mm + this.page_format_mm[0]) * this.zoom / px_in_mm;\n      const view_padding = 20;\n      const inner_width = this.editor_width - 2 * view_padding;\n      let nb_pages_x = 1, page_column, x_pos, x_ofx, left_px, top_mm, bkg_width_mm, bkg_height_mm;\n      if(this.display == \"horizontal\") {\n        if(inner_width > (this.pages.length * page_with_plus_spacing)){\n          nb_pages_x = Math.floor(inner_width / page_with_plus_spacing);\n          left_px = inner_width / (nb_pages_x * 2) * (1 + page_idx * 2) - page_width / 2;\n        } else {\n          nb_pages_x = this.pages.length;\n          left_px = page_with_plus_spacing * page_idx + page_width / 2 * (this.zoom - 1);\n        }\n        top_mm = 0;\n        bkg_width_mm = this.zoom * (this.page_format_mm[0] * nb_pages_x + (nb_pages_x - 1) * page_spacing_mm);\n        bkg_height_mm = this.page_format_mm[1] * this.zoom;\n      } else { // \"grid\", vertical\n        nb_pages_x = Math.floor(inner_width / page_with_plus_spacing);\n        if(nb_pages_x < 1 || this.display == \"vertical\") nb_pages_x = 1;\n        page_column = (page_idx % nb_pages_x);\n        x_pos = inner_width / (nb_pages_x * 2) * (1 + page_column * 2) - page_width / 2;\n        x_ofx = Math.max(0, (page_width * this.zoom - inner_width) / 2);\n        left_px = x_pos + x_ofx;\n        top_mm = ((this.page_format_mm[1] + page_spacing_mm) * this.zoom) * Math.floor(page_idx / nb_pages_x);\n        const nb_pages_y = Math.ceil(this.pages.length / nb_pages_x);\n        bkg_width_mm = this.zoom * (this.page_format_mm[0] * nb_pages_x + (nb_pages_x - 1) * page_spacing_mm);\n        bkg_height_mm = this.zoom * (this.page_format_mm[1] * nb_pages_y + (nb_pages_y - 1) * page_spacing_mm);\n      }\n      if(page_idx >= 0) {\n        const style = {\n          position: \"absolute\",\n          left: \"calc(\"+ left_px +\"px + \"+ view_padding +\"px)\",\n          top: \"calc(\"+ top_mm +\"mm + \"+ view_padding +\"px)\",\n          width: this.page_format_mm[0]+\"mm\",\n          // \"height\" is set below\n          padding: (typeof this.page_margins == \"function\") ? this.page_margins(page_idx + 1, this.pages.length) : this.page_margins,\n          transform: \"scale(\"+ this.zoom +\")\"\n        };\n        style[allow_overflow ? \"minHeight\" : \"height\"] = this.page_format_mm[1]+\"mm\";\n        return style;\n      } else {\n        // Content/background <div> is sized so it lets a margin around pages when scrolling at the end\n        return { width: \"calc(\"+ bkg_width_mm +\"mm + \"+ (2*view_padding) +\"px)\", height: \"calc(\"+ bkg_height_mm +\"mm + \"+ (2*view_padding) +\"px)\" };\n      }\n    },\n\n    // Utility to convert page_style to CSS string\n    css_to_string: (css) => Object.entries(css).map(([k, v]) => k.replace(/[A-Z]/g, match => (\"-\"+match.toLowerCase()))+\":\"+v).join(';'),\n\n    // Update pages <div> from this.pages data\n    update_pages_elts () {\n      // Removing deleted pages\n      for(const page_elt of this.$refs.content.children) {\n        if(!this.pages.find(page => (page.elt == page_elt))) page_elt.remove();\n      }\n\n      // Adding / updating pages\n      for(const [page_idx, page] of this.pages.entries()) {\n        // Get either existing page_elt or create it\n        if(!page.elt) {\n          page.elt = document.createElement(\"div\");\n          page.elt.className = \"page\";\n          page.elt.dataset.isVDEPage = \"\";\n          const next_page = this.pages[page_idx + 1];\n          this.$refs.content.insertBefore(page.elt, next_page ? next_page.elt : null);\n        }\n        // Update page properties\n        page.elt.dataset.contentIdx = page.content_idx;\n        if(!this.printing_mode) page.elt.style = Object.entries(this.page_style(page_idx, page.template ? false : true)).map(([k, v]) => k.replace(/[A-Z]/g, match => (\"-\"+match.toLowerCase()))+\":\"+v).join(';'); // (convert page_style to CSS string)\n        page.elt.contentEditable = (this.editable && !page.template) ? true : false;\n      }\n    },\n\n    // Get and store empty editor <div> width\n    update_editor_width () {\n      this.$refs.editor.classList.add(\"hide_children\");\n      this.editor_width = this.$refs.editor.clientWidth;\n      this.update_pages_elts();\n      this.$refs.editor.classList.remove(\"hide_children\");\n    },\n    update_css_media_style () {\n      this.css_media_style.innerHTML = \"@media print { @page { size: \"+this.page_format_mm[0]+\"mm \"+this.page_format_mm[1]+\"mm; margin: 0 !important; } .hidden-print { display: none !important; } }\";\n    },\n\n    // Prepare content before opening the native print box\n    before_print () {\n      // set the printing mode flag\n      this.printing_mode = true;\n\n      // store the current body aside\n      this._page_body = document.body;\n\n      // create a new body for the print and overwrite CSS\n      const print_body = document.createElement(\"body\");\n      print_body.style.margin = \"0\";\n      print_body.style.padding = \"0\";\n      print_body.style.background = \"white\";\n      print_body.style.font = window.getComputedStyle(this.$refs.editor).font;\n      print_body.className = this.$refs.editor.className;\n\n      // move each page to the print body\n      for(const [page_idx, page] of this.pages.entries()){\n        //const page_clone = page_elt.cloneNode(true);\n        page.elt.style = \"\"; // reset page style for the clone\n        page.elt.style.position = \"relative\";\n        page.elt.style.padding = (typeof this.page_margins == \"function\") ? this.page_margins(page_idx + 1, this.pages.length) : this.page_margins;\n        page.elt.style.breakBefore = page_idx ? \"page\" : \"auto\";\n\n        // add overlays if any\n        const overlay_elt = this.pages_overlay_refs[page.uuid];\n        if(overlay_elt){\n          overlay_elt.style.position = \"absolute\";\n          overlay_elt.style.left = \"0\";\n          overlay_elt.style.top = \"0\";\n          overlay_elt.style.transform = \"none\";\n          overlay_elt.style.padding = \"0\";\n          overlay_elt.style.overflow = \"hidden\";\n          page.elt.prepend(overlay_elt);\n        }\n        \n        print_body.append(page.elt);\n      }\n\n      // display a return arrow to let the user restore the original body in case the navigator doesn't call after_print() (it happens sometimes in Chrome)\n      const return_overlay = document.createElement(\"div\");\n      return_overlay.className = \"hidden-print\"; // css managed in update_css_media_style method\n      return_overlay.style.position = \"fixed\";\n      return_overlay.style.left = \"0\";\n      return_overlay.style.top = \"0\";\n      return_overlay.style.right = \"0\";\n      return_overlay.style.bottom = \"0\";\n      return_overlay.style.display = \"flex\";\n      return_overlay.style.alignItems = \"center\";\n      return_overlay.style.justifyContent = \"center\";\n      return_overlay.style.background = \"rgba(255, 255, 255, 0.95)\";\n      return_overlay.style.cursor = \"pointer\";\n      return_overlay.innerHTML = '<svg width=\"220\" height=\"220\"><path fill=\"rgba(0, 0, 0, 0.7)\" d=\"M120.774,179.271v40c47.303,0,85.784-38.482,85.784-85.785c0-47.3-38.481-85.782-85.784-85.782H89.282L108.7,28.286L80.417,0L12.713,67.703l67.703,67.701l28.283-28.284L89.282,87.703h31.492c25.246,0,45.784,20.538,45.784,45.783C166.558,158.73,146.02,179.271,120.774,179.271z\"/></svg>'\n      return_overlay.addEventListener(\"click\", this.after_print);\n      print_body.append(return_overlay);\n\n      // replace current body by the print body\n      document.body = print_body;\n    },\n\n    // Restore content after closing the native print box\n    after_print () {\n      // clear the printing mode flag\n      this.printing_mode = false;\n\n      // restore pages and overlays\n      for(const [page_idx, page] of this.pages.entries()){\n        page.elt.style = this.css_to_string(this.page_style(page_idx, page.template ? false : true));\n        this.$refs.content.append(page.elt);\n        const overlay_elt = this.pages_overlay_refs[page.uuid];\n        if(overlay_elt) {\n          overlay_elt.style = this.css_to_string(this.page_style(page_idx, false));\n          this.$refs.overlays.append(overlay_elt);\n        }\n      }\n      document.body = this._page_body;\n\n      // recompute editor with and reposition elements\n      this.update_editor_width();\n    }\n  },\n\n  // Watch for changes and adapt content accordingly\n  watch: {\n    content: {\n      handler () {\n        // prevent infinite loop as reset_content triggers a content update and it's async\n        if(this.prevent_next_content_update_from_parent) {\n          this.prevent_next_content_update_from_parent = false;\n        } else this.reset_content();\n      },\n      deep: true\n    },\n    display: {\n      handler () { this.update_pages_elts(); }\n    },\n    page_format_mm: {\n      handler () {\n        this.update_css_media_style();\n        this.reset_content();\n      }\n    },\n    page_margins: {\n      handler () {\n        this.reset_content();\n      }\n    },\n    zoom: {\n      handler () { this.update_pages_elts(); }\n    }\n  }\n\n}\n</script>\n\n<style>\nbody {\n  /* Enable printing of background colors */\n  -webkit-print-color-adjust: exact;\n  print-color-adjust: exact;\n}\n</style>\n<style scoped>\n.editor {\n  display: block;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  cursor: default;\n}\n.editor ::-webkit-scrollbar {\n  width: 16px;\n  height: 16px;\n}\n.editor ::-webkit-scrollbar-track,\n.editor ::-webkit-scrollbar-corner {\n  display: none;\n}\n.editor ::-webkit-scrollbar-thumb {\n  background-color: rgba(0, 0, 0, 0.5);\n  border: 5px solid transparent;\n  border-radius: 16px;\n  background-clip: content-box;\n}\n.editor ::-webkit-scrollbar-thumb:hover {\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.editor .hide_children > * {\n  display: none;\n}\n.editor > .content {\n  position: relative;\n  outline: none;\n  margin: 0;\n  padding: 0;\n  min-width: 100%;\n  pointer-events: none;\n}\n.editor > .content > :deep(.page) {\n  position: absolute;\n  box-sizing: border-box;\n  left: 50%;\n  transform-origin: center top;\n  background: var(--page-background, white);\n  box-shadow: var(--page-box-shadow, 0 1px 3px 1px rgba(60, 64, 67, 0.15));\n  border: var(--page-border);\n  border-radius: var(--page-border-radius);\n  transition: left 0.3s, top 0.3s;\n  overflow: hidden;\n  pointer-events: all;\n}\n.editor > .content[contenteditable],\n.editor > .content :deep(*[contenteditable]) {\n  cursor: text;\n}\n.editor > .content :deep(*[contenteditable=false]) {\n  cursor: default;\n}\n.editor > .overlays {\n  position: relative;\n  margin: 0;\n  padding: 0;\n  min-width: 100%;\n  pointer-events: none;\n}\n.editor > .overlays > .overlay {\n  position: absolute;\n  box-sizing: border-box;\n  left: 50%;\n  transform-origin: center top;\n  transition: left 0.3s, top 0.3s;\n  overflow: hidden;\n  z-index: 1;\n}\n</style>"],"sourceRoot":""}]}